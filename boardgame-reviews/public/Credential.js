(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"7vb0":function(e,t,r){(e.exports=r("I1BE")(!1)).push([e.i,"\n.favorite_shops[data-v-523c9286] {\n  background-color: white;\n  margin-bottom: 4em;\n  padding: 2em;\n  border-radius: 0.5em;\n}\n.credential[data-v-523c9286] {\n  background-color: white;\n  margin-bottom: 4em;\n  padding: 2em;\n  border-radius: 0.5em;\n}\n.favorite_shop[data-v-523c9286] {\n  background-color: whitesmoke;\n  margin: 0.5em;\n  border-radius: 0.5em;\n}\n",""])},"9LN+":function(e,t,r){var a=r("7vb0");"string"==typeof a&&(a=[[e.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};r("aET+")(a,s);a.locals&&(e.exports=a.locals)},"EzE/":function(e,t,r){"use strict";r.r(t);var a=r("o0o1"),s=r.n(a),i=r("DxOX"),n=r("jJT+"),o=r("JZNc"),c=r("axVk"),l=r("Wswj"),d=r("jMhu"),u=r("mwd/");function p(e,t,r,a,s,i,n){try{var o=e[i](n),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(a,s)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(a,s){var i=e.apply(t,r);function n(e){p(i,a,s,n,o,"next",e)}function o(e){p(i,a,s,n,o,"throw",e)}n(void 0)}))}}var m,v,h,b,w,_={components:{shop:n.a,bdProfileEditModal:o.a,bdRetireModal:c.a,bdUserIcon:l.a,bdBread:d.a,bdTextField:u.a},name:"profile",data:function(){return{user:null,errors:null,editProfileModalActive:!1,retireModalActive:!1,credentialFlg:this.$route.params.credential_flg,credentialForm:{currentPassword:"",email:"",password:"",errors:""}}},methods:{fetchUser:(w=f(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.get("/api/profile");case 2:if((t=e.sent).status===i.d){e.next=6;break}return this.$store.commit("error/setCode",t.status),e.abrupt("return",!1);case 6:this.user=t.data;case 7:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)}),showProfileEditModal:function(){this.editProfileModalActive=!0},showRetireModal:function(){this.retireModalActive=!0},updateProfile:(b=f(s.a.mark((function e(t){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("name",t.name),r.append("photo",t.file),e.next=5,axios.post("/api/profile/edit",r);case 5:if((a=e.sent).status!==i.f){e.next=9;break}return this.errors=a.data.errors,e.abrupt("return",!1);case 9:this.fetchUser(),this.reload(),t.teardown&&t.teardown(),this.editProfileModalActive=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)}),retire:(h=f(s.a.mark((function e(t){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("password",t.password),e.next=4,axios.post("/api/profile/destroy",r);case 4:if((a=e.sent).status!==i.f){e.next=10;break}return this.errors=a.data.errors,e.abrupt("return",!1);case 10:if(403!==a.status){e.next=13;break}return this.errors=a.data.message,e.abrupt("return",!1);case 13:this.$store.commit("message/setContent",{content:"ご利用ありがとうございました！",timeout:6e3}),this.$router.push("/");case 15:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)}),cancel:function(){this.errors=null,this.editProfileModalActive=!1,this.retireModalActive=!1},reload:function(){this.$router.go({path:this.$router.currentRoute.path,force:!0})},updateCredential:(v=f(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.credentialForm.email&&!this.credentialForm.password){e.next=16;break}return e.next=3,axios.post("/api/profile/credential",this.credentialForm);case 3:if((t=e.sent).status!==i.f){e.next=9;break}return this.credentialForm.errors=t.data.errors,e.abrupt("return",!1);case 9:if(403!==t.status){e.next=12;break}return this.credentialForm.errors={msg:t.data.message},e.abrupt("return",!1);case 12:this.clearForm(),alert("認証情報を変更しました！"),e.next=17;break;case 16:this.credentialForm.errors={null:"　新しいメールアドレスか新しいパスワードのどちらかは入力してください"};case 17:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)}),valuecheck:function(){},clearForm:function(){this.credentialForm.errors="",this.credentialForm.currentPassword="",this.credentialForm.email="",this.credentialForm.password=""}},watch:{$route:{handler:(m=f(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchUser();case 2:this.valuecheck();case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)}),immediate:!0}}},x=(r("fZ7/"),r("KHd+")),F=Object(x.a)(_,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("bdBread"),e._v(" "),r("div",{staticClass:"columns"},[r("div",{staticClass:"column is-one-fifth"},[r("div",{staticClass:"card"},[r("div",{staticClass:"card-content"},[e.user.icon_url?r("figure",{staticClass:"image is-4by3"},[r("img",{attrs:{src:e.user.icon_url}})]):e._e(),e._v(" "),""==e.user.icon_url||null==e.user.icon_url?r("bdUserIcon"):e._e(),e._v(" "),e.user?r("p",{staticClass:"subtitle has-text-centered has-text-dark"},[e._v("name: "+e._s(e.user.name))]):e._e()],1),e._v(" "),r("footer",{staticClass:"card-footer"},[r("button",{staticClass:"button is-small is-primary is-outlined is-fullwidth",on:{click:e.showProfileEditModal}},[e._v("編集")]),e._v(" "),r("button",{staticClass:"button is-small is-primary is-outlined is-fullwidth",on:{click:e.showRetireModal}},[e._v("退会")])])])]),e._v(" "),r("div",{staticClass:"column is-for-fifths"},[r("div",{staticClass:"credential"},[e._m(0),e._v(" "),r("transition",{attrs:{name:"error"}},[e.credentialForm.errors?r("div",{staticClass:"errors"},[e.credentialForm.errors.msg?r("ul",[r("li",[e._v(e._s(e.credentialForm.errors.msg))])]):e._e(),e._v(" "),e.credentialForm.errors.null?r("ul",[r("li",[e._v(e._s(e.credentialForm.errors.null))])]):e._e()]):e._e()]),e._v(" "),r("bdTextField",{attrs:{type:"password",placeholder:"現在のパスワード（必須）",icon:"key"},model:{value:e.credentialForm.currentPassword,callback:function(t){e.$set(e.credentialForm,"currentPassword",t)},expression:"credentialForm.currentPassword"}}),e._v(" "),r("bdTextField",{attrs:{type:"email",placeholder:"新しいメールアドレス",icon:"envelope"},model:{value:e.credentialForm.email,callback:function(t){e.$set(e.credentialForm,"email",t)},expression:"credentialForm.email"}}),e._v(" "),r("bdTextField",{attrs:{type:"password",placeholder:"新しいパスワード",icon:"lock"},model:{value:e.credentialForm.password,callback:function(t){e.$set(e.credentialForm,"password",t)},expression:"credentialForm.password"}}),e._v(" "),r("div",{staticClass:"field is-grouped"},[r("div",{staticClass:"control"},[r("button",{staticClass:"button is-primary",on:{click:function(t){return t.preventDefault(),e.updateCredential(t)}}},[e._v("更新")])])])],1)])]),e._v(" "),r("bdProfileEditModal",{attrs:{active:e.editProfileModalActive,name:e.user.name,errors:e.errors},on:{update:e.updateProfile,cancel:e.cancel},model:{value:e.editProfileModalActive,callback:function(t){e.editProfileModalActive=t},expression:"editProfileModalActive"}}),e._v(" "),r("bdRetireModal",{attrs:{active:e.retireModalActive,errors:e.errors},on:{retire:e.retire,cancel:e.cancel},model:{value:e.retireModalActive,callback:function(t){e.retireModalActive=t},expression:"retireModalActive"}})],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"level"},[t("div",{staticClass:"level-left"},[t("div",{staticClass:"level-item"},[t("h2",{staticClass:"title is-6 has-text-left"},[this._v("認証情報変更")])])])])}],!1,null,"523c9286",null);t.default=F.exports},"fZ7/":function(e,t,r){"use strict";var a=r("9LN+");r.n(a).a}}]);