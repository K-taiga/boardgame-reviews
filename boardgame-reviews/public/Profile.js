(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{GgfX:function(t,e,r){"use strict";r.r(e);var a=r("o0o1"),s=r.n(a),i=r("DxOX"),n=r("jJT+"),o=r("JZNc"),c=r("axVk"),l=r("Wswj"),u=r("jMhu"),d=r("mwd/");function f(t,e,r,a,s,i,n){try{var o=t[i](n),c=o.value}catch(t){return void r(t)}o.done?e(c):Promise.resolve(c).then(a,s)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(a,s){var i=t.apply(e,r);function n(t){f(i,a,s,n,o,"next",t)}function o(t){f(i,a,s,n,o,"throw",t)}n(void 0)}))}}var h,p,m,b,_={components:{shop:n.a,bdProfileEditModal:o.a,bdRetireModal:c.a,bdUserIcon:l.a,bdBread:u.a,bdTextField:d.a},name:"profile",data:function(){return{user:null,errors:null,editProfileModalActive:!1,retireModalActive:!1}},methods:{fetchUser:(b=v(s.a.mark((function t(){var e;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.get("/api/profile/");case 2:if((e=t.sent).status===i.d){t.next=6;break}return this.$store.commit("error/setCode",e.status),t.abrupt("return",!1);case 6:this.user=e.data;case 7:case"end":return t.stop()}}),t,this)}))),function(){return b.apply(this,arguments)}),showProfileEditModal:function(){this.editProfileModalActive=!0},showRetireModal:function(){this.retireModalActive=!0},updateProfile:(m=v(s.a.mark((function t(e){var r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new FormData).append("name",e.name),r.append("photo",e.file),t.next=5,axios.post("/api/profile/edit",r);case 5:if((a=t.sent).status!==i.f){t.next=9;break}return this.errors=a.data.errors,t.abrupt("return",!1);case 9:this.fetchUser(),this.reload(),e.teardown&&e.teardown(),this.editProfileModalActive=!1;case 13:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)}),retire:(p=v(s.a.mark((function t(e){var r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new FormData).append("password",e.password),t.next=4,axios.post("/api/profile/destroy",r);case 4:if((a=t.sent).status!==i.f){t.next=10;break}return this.errors=a.data.errors,t.abrupt("return",!1);case 10:if(403!==a.status){t.next=13;break}return this.errors=a.data.message,t.abrupt("return",!1);case 13:this.$store.commit("message/setContent",{content:"ご利用ありがとうございました！",timeout:6e3}),this.$router.push("/");case 15:case"end":return t.stop()}}),t,this)}))),function(t){return p.apply(this,arguments)}),cancel:function(){this.errors=null,this.editProfileModalActive=!1,this.retireModalActive=!1},reload:function(){this.$router.go({path:this.$router.currentRoute.path,force:!0})}},watch:{$route:{handler:(h=v(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetchUser();case 2:this.valuecheck();case 3:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)}),immediate:!0}}},w=(r("OUrp"),r("KHd+")),x=Object(w.a)(_,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container"},[r("bdBread"),t._v(" "),r("div",{staticClass:"columns"},[r("div",{staticClass:"column is-one-fifth"},[r("div",{staticClass:"card"},[r("div",{staticClass:"card-content"},[t.user.icon_url?r("figure",{staticClass:"image is-4by3"},[r("img",{attrs:{src:t.user.icon_url}})]):t._e(),t._v(" "),""==t.user.icon_url?r("bdUserIcon"):t._e(),t._v(" "),t.user?r("p",{staticClass:"subtitle has-text-centered has-text-dark"},[t._v("\n                        name: "+t._s(t.user.name)+"\n                    ")]):t._e()],1),t._v(" "),r("footer",{staticClass:"card-footer"},[r("button",{staticClass:"button is-small is-primary is-outlined is-fullwidth",on:{click:t.showProfileEditModal}},[t._v("\n                        編集\n                    ")]),t._v(" "),r("button",{staticClass:"button is-small is-primary is-outlined is-fullwidth",on:{click:t.showRetireModal}},[t._v("\n                        退会\n                    ")])])])]),t._v(" "),r("div",{staticClass:"column is-for-fifths"},[r("div",{staticClass:"favorite_shops"},[t._m(0),t._v(" "),0!==t.user.favorite_shops.count?r("div",{staticClass:"columns is-multiline"},t._l(t.user.favorite_shops,(function(t){return r("shop",{key:t.id,staticClass:"favorite_shop",attrs:{item:t}})})),1):t._e(),t._v(" "),0===t.user.favorite_shops.length?r("p",{staticClass:"has-text-left"},[r("strong",[t._v("まだお気に入りはありません。")])]):t._e()])])]),t._v(" "),r("bdProfileEditModal",{attrs:{active:t.editProfileModalActive,name:t.user.name,errors:t.errors},on:{update:t.updateProfile,cancel:t.cancel},model:{value:t.editProfileModalActive,callback:function(e){t.editProfileModalActive=e},expression:"editProfileModalActive"}}),t._v(" "),r("bdRetireModal",{attrs:{active:t.retireModalActive,errors:t.errors},on:{retire:t.retire,cancel:t.cancel},model:{value:t.retireModalActive,callback:function(e){t.retireModalActive=e},expression:"retireModalActive"}})],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"level"},[e("div",{staticClass:"level-left"},[e("div",{staticClass:"level-item"},[e("h2",{staticClass:"title is-6 has-text-left"},[this._v("\n                                Favorite Shops\n                            ")])])])])}],!1,null,"526d5a8b",null);e.default=x.exports},OUrp:function(t,e,r){"use strict";var a=r("Z0PL");r.n(a).a},Z0PL:function(t,e,r){var a=r("wSSg");"string"==typeof a&&(a=[[t.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};r("aET+")(a,s);a.locals&&(t.exports=a.locals)},wSSg:function(t,e,r){(t.exports=r("I1BE")(!1)).push([t.i,"\n.favorite_shops[data-v-526d5a8b] {\n    background-color: white;\n    margin-bottom: 4em;\n    padding: 2em;\n    border-radius: 0.5em;\n}\n.credential[data-v-526d5a8b] {\n    background-color: white;\n    margin-bottom: 4em;\n    padding: 2em;\n    border-radius: 0.5em;\n}\n.favorite_shop[data-v-526d5a8b] {\n    background-color: whitesmoke;\n    margin: 0.5em;\n    border-radius: 0.5em;\n}\n",""])}}]);